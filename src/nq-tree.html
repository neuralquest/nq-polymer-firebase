<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="nq-tree-node.html">

<!--
`my-blank-element`
yes

@demo demo/index.html
-->

<dom-module id="nq-tree">
    <template>
        <style>
            :host {
                --app-primary-color: #4285f4;
                --app-secondary-color: black;
                display: block;

                --paper-tree-selected-background-color: rgba(0, 0, 200, 0.2);

            }


        </style>

        <firebase-document
                path="/documents/[[viewId]]"
                data="{{view}}">
        </firebase-document>

        <firebase-document
                path="[[computeDocPath(view)]]"
                data="{{data}}">
        </firebase-document>


        <nq-tree-node id="root"
                      data="[[data]]"
                      level="[[level]]"
                      node-query="[[view.rootQuery]]"
                      children-query="[[view.query]]"
                      view-query="[[view.query]]"
                      doc-id="[[getDocId(view)]]"
                      on-select="selectNode"></nq-tree-node>

    </template>


    <script>
        class NqTree extends Polymer.Element {
            static get is() {
                return 'nq-tree';
            }

            static get properties() {
                return {
                    level: Number,
                    viewId: String,
                    docId: String,
                    pageId: String,
                    data: {
                        type: 'Object',
                        value(){return {'name': 'Loading...'}}
                    },
                    /**
                     * `selected` is the current selected `<paper-tree-node>` in the tree.
                     */
                    selected: {
                        type: Object,
                        value: null
                    }
                };
            }

            computeDocPath(view){
                if(Object.keys(view).length === 0) return null;
                return "/documents/"+this.getDocId(view);
            }
            getDocId(view){
                if(!view || !view.rootQuery || !view.rootQuery.where || !view.rootQuery.where.value) return null;
                var value = view.rootQuery.where.value;
                var docId = value;
                if(value === '$docId') docId = this.docId;
                if(value === '$parent.initialDocId') return null;//$parent.initialDocId
                return docId;
            }
            /**
             * Called when the `select` event is fired from an internal node.
             *
             * @param {object} e An event object.
             */
            selectNode(e) {
                if(this.selected) {
                    //this.toggleClass("selected", false, this.selected);
                    //this.$.grid.classList.add('classname')

                    //this.$.grid.classList.remove('classname')
                }

                // Only selects `<nq-tree-node>`.
                if (e.detail && e.detail.tagName === 'NQ-TREE-NODE') {
                    this.selected = e.detail;
                    //this.toggleClass("selected", true, this.selected);
                } else {
                    this.selected = null;
                }
            }

        }
        window.customElements.define(NqTree.is, NqTree);
    </script>

</dom-module>