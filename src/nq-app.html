<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="nq-layout.html">

<!--
`my-blank-element`
yes

@demo demo/index.html
-->

<dom-module id="nq-app">

    <style include="iron-flex iron-flex-alignment iron-positioning"></style>

    <style>
        :host {
            --app-primary-color: #4285f4;
            --app-secondary-color: black;
            display: block;
            height: 100%;
            position: relative;
        }
        paper-toolbar.bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
    </style>

    <template>
        <!-- IMPORTANT: The firebase-app element needs to appear before any
             other firebase-* elements -->
        <firebase-app
            id="firebase"
            api-key="AIzaSyBrQE0rTSS0X7Vn309Vjb2hU8BirhJJ6B8"
            auth-domain="neuralquest-395e9.firebaseapp.com"
            database-url="https://neuralquest-395e9.firebaseio.com">
        </firebase-app>

        <firebase-auth
            id="auth"
            user="{{user}}"
            status-known="{{statusKnown}}"
            provider="google">
        </firebase-auth>

        <app-location route="{{route}}" use-hash-as-path></app-location>

        <template is="dom-if" if="[[pageIdComputed]]">
            <div>
            <div class="layout vertical fit">
                <nq-layout class="flex" level="[[level]]" page-id="[[pageIdComputed]]"></nq-layout>
                <paper-toolbar>
                    <span>
                        <paper-button raised on-tap="login" hidden$="[[user]]">Sign in</paper-button>
                        <paper-button raised on-tap="logout" hidden$="[[!user]]">Sign out</paper-button>
                    </span>
                    <span>
                        <template is="dom-if" if="[[user]]">
                            <p>User: [[user.displayName]]</p>
                        </template>
                    </span>
                    <span style="flex: 1;"></span>
                    <span style="width: 160px">
                        <img src="https://firebasestorage.googleapis.com/v0/b/neuralquest-395e9.appspot.com/o/lefkasHome1.png?alt=media&token=bc30558d-8b6c-47b1-a1b7-87df68851fdd"
                             width="160px" height="24px">
                        <div style="position:absolute;top:15px; width:inherit;text-align:center;font-size:20px;font-weight:bold;color:white;text-shadow: 2px 2px 4px black">Neuralquest</div>
                    </span>
                </paper-toolbar>
            </div></div>
        </template>

    </template>

    <script>
        Polymer({
            is: 'nq-app',
            properties: {
                pageId: {
                    type: String,
                    value: null
                },
                level: {
                    type: Number,
                    value: 0
                },
                route: {
                    type: String
                },
                pageIdComputed: {
                    type: String,
                    computed: 'computePageId(level, route, pageId)'
                },
                user: {
                    type: Object
                },
                statusKnown: {
                    type: Object
                }
            },
            //doesn't work, comes after compute page id
            attached: function(){
                if(!this.route.path){
                    this.set('route.path', '.575d4c3f2cf3d6dc3ed83146...575d4c3f2cf3d6dc3ed83148.575d4c3f2cf3d6dc3ed83147');
                    this.notifyPath('route.path');//doesn't work
                }
            },
            computePageId(level, route, pageId){
                //console.log('computePageId');
                if(pageId) return pageId;
                if(!this.route.path){
                    this.set('route.path', '.575d4c3f2cf3d6dc3ed83146...575d4c3f2cf3d6dc3ed83148.575d4c3f2cf3d6dc3ed83147');
                }
                var pathArr = route.path.split('.');
                return pathArr[level*4+1];
            },
            login: function() {
                return this.$.auth.signInWithPopup();
            },
            logout: function() {
                return this.$.auth.signOut();
            },
            ready: function () {
                //console.log('ready level', this.level, 'pageId', this.pageId, 'pageIdComputed', this.pageIdComputed);
            }
        });
    </script>
</dom-module>