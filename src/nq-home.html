<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
<!--
`my-blank-element`
yes

@demo demo/index.html
-->

<dom-module id="nq-home">
    <template>

        <style include="iron-flex iron-flex-alignment iron-positioning"></style>

        <style>
            :host {
                --app-primary-color: #4285f4;
                --app-secondary-color: black;

                display: block;
                height: 100%;
                position: relative;
            }
            paper-button {
                background: #4285f4;
                color: white;
            }
        </style>

<!--

-->
        <firebase-document id="doc"></firebase-document>
        <firebase-query
                id="ajax"
                path=""
                data="{{views}}">
        </firebase-query>

        <paper-button on-tap="onTap">Query</paper-button>
        <paper-button on-tap="onTap2">compute qury</paper-button>

        <a-scene>
            <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
            <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
            <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
            <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
            <a-sky color="#ECECEC"></a-sky>
        </a-scene>

    </template>

    <script>
        class NqHome extends Polymer.Element {
            static get is() {
                return 'nq-home';
            }

            static get properties() {
                return {
                    level: Number,
                    viewId: String,
                    docId: String,
                    schema:{
                        type:Object,
                        value: function() { return {}; },
                        //observer: 'dataChanged'
                    },
                    views:{
                        type:Array,
                        value: function() { return []; },
                        observer: 'dataChanged'
                    }
                };
            }
            static get Xobservers() {
                return [
                    'dataChanged(views)'
                ];
            }
            dataChanged(views, oldValue) {
            }
            onTap(event) {

                this.$.ajax.set('path',"/documents");
                this.$.ajax.set('orderByChild','classId');
                this.$.ajax.set('equalTo','573435c23c6d3cd598a5a2df');
            }
            onTap2(event) {
                this.views.forEach(function(view, idx){
                    var key = view.$key;
                    delete view.$key;
                    //delete view.newQuery;
                    this.$.doc.path = null; //makes sure to not override any other data
                    this.$.doc.data = view; //data that you want to save
                    this.$.doc.saveValue('/documents', key); //path in firebase where you want to save your data


                    //this.$.ajax.setStoredValue(view.$key, view).then(function () {
                        // after document saved, path will be changed to the new ref
                        // any change of data will sent back up and stored
                    //});
                }.bind(this));

                this.views.forEach(function(view, idx){
                    console.log(view.name);
                    console.dir(view);
                }.bind(this));
            }

        }
        window.customElements.define(NqHome.is, NqHome);
    </script>
</dom-module>