<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="nq-view-data.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<!--
`my-blank-element`
yes

@demo demo/index.html
-->

<dom-module id="nq-form">
    <template>
        <style>
            :host {
                --app-primary-color: #4285f4;
                --app-secondary-color: black;

                display: block;
            }

        </style>

        <nq-view-data view-id="{{viewId}}" view-doc="{{viewDoc}}"></nq-view-data>

        <firebase-document
                path="/documents/[[docId]]"
                data="{{doc}}">
        </firebase-document>


        <!--<firebase-document
                path="/documents/{{viewId}}"
                data="{{view}}">
        </firebase-document>-->

        <!-- Only one tab, so no tab bar -->
        <table>
        <template is="dom-repeat" doc={{doc}} items="{{viewPropArr}}" as="property">
            <tr>
                <td>{{property.prop.title}}</td>
                <td>{{property.value}}</td>
            </tr>
        </template>
        </table>
    </template>

    <script>
        Polymer({

            is: 'nq-form',

            properties: {
                level: Number,
                viewId: String,
                docId: String,
                viewDoc:{
                    type:Object,
                    value: function() { return {}; },
                    observer: 'dataChanged'
                },
                viewPropArr:{
                    type: Array,
                    value: function() { return []; },
                    computed: '_toArray(viewDoc, doc)',
                    //observer: 'dataChanged'
                }
            },
            _toArray: function(viewDoc, doc) {
                if(!viewDoc.properties) return [];
                var obj = viewDoc.properties;
                var arr =  Object.keys(obj).map(function(key) {
                    return {
                        name: key,
                        prop: obj[key],
                        value: doc[key]
                    };
                });
                return arr;
            },
            dataChanged: function(newValue, oldValue) {
                console.log('viewDoc:', oldValue, 'to', newValue);
            }
        });
    </script>
</dom-module>