<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../bower_components/vaadin-form-layout/vaadin-form-item.html">
<link rel="import" href="../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="nq-icons.html">
<link rel="import" href="nq-view-data.html">
<link rel="import" href="nq-form-digit.html">

<!--
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/polymer-quill/polymer-quill.html">
<link rel="import" href="../bower_components/polymer-quill/polymer-quill-html-render.html">
-->
<!--
`my-blank-element`
yes

@demo demo/index.html
-->

<dom-module id="nq-form">
    <template>
        <style>
            :host {
                --app-primary-color: #4285f4;
                --app-secondary-color: black;

                display: block;
                margin: 10px;
            }
            paper-fab {
                margin-left: 10px;
                margin-right: 10px;
                margin-bottom: 70px;
                position: fixed;
                right: 25px;
                bottom: 25px;
            }

        </style>

        <nq-view-data view-id="{{viewId}}" view-doc="{{viewDoc}}"></nq-view-data>

        <firebase-document
                path="/documents/[[docId]]"
                data="{{document}}"
                log>
        </firebase-document>

        <nq-form-digit document="{{document}}"
                       prop-value-arr="[[getPropValueArr(viewDoc, document)]]"
                       edit-mode="[[editMode]]"
                       on-docchanged="onDocChanged"></nq-form-digit>


        <paper-fab hidden={{!readOnly}}  icon="nq-icons:edit" on-tap="doEdit" mini></paper-fab>
        <paper-fab hidden={{readOnly}} icon="nq-icons:done" on-tap="doEdit" mini></paper-fab>

    </template>

    <script>
        class NqForm extends Polymer.Element {
            static get is() {
                return 'nq-form';
            }

            static get properties() {
                return {
                    level: Number,
                    viewId: String,
                    docId: String,
                    editMode:{
                        type: Boolean,
                        value: false,
                        //observer: 'dataChanged'
                    },
                    viewDoc:{
                        type:Object,
                        value() { return {}; },
                    },
                    document:{
                        type:Object,
                        value() { return {}; },
                        notify: true
                    }
                };
            }
            getPropValueArr(viewDoc, doc) {
                if(!viewDoc.properties || !doc) return [];
                var obj = viewDoc.properties;
                var arr =  Object.keys(obj).map(function(key) {
                    return {
                        path: 'document.'+key,
                        attrProps: obj[key],
                        value: doc[key]
                    };
                });
                return arr;
            }
            doEdit(e){
                this.editMode=!this.editMode;
            }

            onDocChanged(event) {
                //console.log('document:', event.detail);
                var propValue = event.detail;
                this.set(propValue.path, propValue.value);
            }
            dataChanged(newValue, oldValue) {
                console.log('document:', newValue);
            }
        }
        window.customElements.define(NqForm.is, NqForm);
    </script>
</dom-module>
